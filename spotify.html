<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spotify Downloader</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif}
body{background:#0b0f1a;color:#fff;min-height:100vh}

/* Top Bar */
.topbar{
    padding:15px 20px;
    background:#11162a;
    border-bottom:1px solid #1DB954;
    display:flex;
    align-items:center;
    gap:12px;
}

.back-btn{
    width:40px;
    height:40px;
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius:10px;
    background:#0f1530;
    color:#1DB954;
    text-decoration:none;
    font-size:18px;
}

.title-text{
    font-size:20px;
    font-weight:600;
    color:#1DB954;
}

/* Main */
.container{max-width:900px;margin:auto;padding:20px}

.box{
    background:#11162a;
    padding:25px;
    border-radius:14px;
    border:1px solid #1DB95440;
    margin-bottom:20px;
}

.box h2{
    font-size:18px;
    margin-bottom:15px;
    color:#1DB954;
    display:flex;
    align-items:center;
    gap:10px;
}

.input{
    width:100%;
    padding:14px;
    border-radius:10px;
    border:1px solid #1DB95460;
    outline:none;
    font-size:14px;
    background:#0f1530;
    color:#fff;
    transition:all 0.3s ease;
}

.input:focus{
    border-color:#1DB954;
    box-shadow:0 0 0 2px #1DB95440;
}

.btn{
    margin-top:15px;
    width:100%;
    padding:14px;
    border:none;
    border-radius:10px;
    background:linear-gradient(135deg, #1DB954 0%, #17a850 100%);
    color:#fff;
    font-size:15px;
    font-weight:600;
    cursor:pointer;
    transition:all 0.3s ease;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:10px;
}

.btn:hover{
    background:linear-gradient(135deg, #1ed760 0%, #1DB954 100%);
    transform:translateY(-2px);
    box-shadow:0 5px 15px rgba(29, 185, 84, 0.3);
}

.btn:disabled{
    background:#555;
    cursor:not-allowed;
    transform:none;
    box-shadow:none;
}

/* Loading */
.loading{
    text-align:center;
    padding:20px;
    display:none;
}

.spinner{
    border:3px solid rgba(29, 185, 84, 0.2);
    border-radius:50%;
    border-top:3px solid #1DB954;
    width:40px;
    height:40px;
    animation:spin 1s linear infinite;
    margin:0 auto 15px;
}

@keyframes spin{
    0%{transform:rotate(0deg)}
    100%{transform:rotate(360deg)}
}

/* Result */
.result{margin-top:20px}

.track-info{
    background:#0f1530;
    padding:20px;
    border-radius:12px;
    margin-bottom:20px;
    border:1px solid #1DB95440;
}

.track-header{
    display:flex;
    align-items:center;
    gap:15px;
    margin-bottom:15px;
}

.track-thumb{
    width:80px;
    height:80px;
    border-radius:8px;
    object-fit:cover;
    border:2px solid #1DB954;
}

.track-text h3{
    font-size:18px;
    margin-bottom:5px;
    color:#fff;
}

.track-text p{
    color:#1DB954;
    font-size:14px;
}

.track-duration{
    display:flex;
    align-items:center;
    gap:8px;
    color:#888;
    font-size:14px;
    margin-top:10px;
}

.download-options{
    background:#0f1530;
    padding:20px;
    border-radius:12px;
    border:1px solid #1DB95440;
}

.download-options h3{
    font-size:16px;
    margin-bottom:15px;
    color:#1DB954;
    display:flex;
    align-items:center;
    gap:10px;
}

.download-item{
    background:#11162a;
    padding:15px;
    border-radius:10px;
    margin-bottom:12px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    border:1px solid #1DB95420;
    transition:all 0.3s ease;
}

.download-item:hover{
    border-color:#1DB954;
    transform:translateX(5px);
}

.quality-info{
    display:flex;
    align-items:center;
    gap:10px;
}

.quality-badge{
    background:#1DB954;
    color:#fff;
    padding:5px 12px;
    border-radius:20px;
    font-size:12px;
    font-weight:600;
}

.format-badge{
    background:#1DB95430;
    color:#1DB954;
    padding:5px 12px;
    border-radius:20px;
    font-size:12px;
}

.download-btn{
    background:#1DB954;
    color:#fff;
    text-decoration:none;
    padding:8px 20px;
    border-radius:8px;
    font-size:14px;
    font-weight:600;
    display:flex;
    align-items:center;
    gap:8px;
    transition:all 0.3s ease;
}

.download-btn:hover{
    background:#1ed760;
    transform:translateY(-2px);
    box-shadow:0 4px 12px rgba(29, 185, 84, 0.3);
}

/* Error Message */
.error{
    background:#dc354520;
    color:#ff6b6b;
    padding:15px;
    border-radius:10px;
    border-left:4px solid #dc3545;
    margin-top:15px;
    display:none;
}

/* Instructions */
.instructions{
    background:#0f1530;
    padding:20px;
    border-radius:12px;
    border:1px solid #1DB95440;
    margin-top:20px;
}

.instructions h3{
    color:#1DB954;
    margin-bottom:15px;
    font-size:16px;
}

.instructions ol{
    padding-left:20px;
    line-height:1.6;
    margin-bottom:15px;
}

.instructions li{
    margin-bottom:8px;
}

.example{
    background:#11162a;
    padding:12px;
    border-radius:8px;
    font-family:monospace;
    font-size:13px;
    color:#1DB954;
    word-break:break-all;
}

/* Footer */
.footer{
    text-align:center;
    padding:18px;
    font-size:12px;
    opacity:0.6;
    margin-top:30px;
}

/* Empty State */
.empty-state{
    text-align:center;
    padding:40px 20px;
    color:#888;
}

.empty-state i{
    font-size:48px;
    margin-bottom:15px;
    color:#1DB95440;
}

.empty-state h3{
    color:#aaa;
    margin-bottom:10px;
}

/* Responsive */
@media (max-width: 768px){
    .container{padding:15px}
    .box{padding:20px}
    .track-header{flex-direction:column;text-align:center}
    .track-thumb{width:120px;height:120px}
}
</style>
</head>

<body>

<!-- Top Bar -->
<div class="topbar">
    <a href="index.html" class="back-btn">
        <i class="fas fa-arrow-left"></i>
    </a>
    <div class="title-text"><i class="fab fa-spotify"></i> Spotify Downloader</div>
</div>

<!-- Content -->
<div class="container">
    <div class="box">
        <h2><i class="fas fa-link"></i> Paste Spotify Track URL</h2>
        <input class="input" id="url" placeholder="https://open.spotify.com/track/506bkQDwzIRnUTvoXv830S" />
        <button class="btn" onclick="fetchTrack()" id="fetchBtn">
            <i class="fas fa-download"></i> Get Track
        </button>

        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Fetching track information...</p>
        </div>

        <!-- Error -->
        <div class="error" id="error"></div>

        <!-- Instructions -->
        <div class="instructions">
            <h3><i class="fas fa-info-circle"></i> How to use:</h3>
            <ol>
                <li>Open Spotify app or website</li>
                <li>Find the track you want to download</li>
                <li>Click on the "Share" button</li>
                <li>Copy the track link</li>
                <li>Paste it above and click "Get Track"</li>
            </ol>
            <p>Example URL:</p>
            <div class="example">https://open.spotify.com/track/506bkQDwzIRnUTvoXv830S</div>
        </div>
    </div>

    <!-- Result Area -->
    <div id="result">
        <div class="box empty-state">
            <i class="fas fa-music"></i>
            <h3>No Track Loaded</h3>
            <p>Enter a Spotify URL to see track details and download options</p>
        </div>
    </div>
</div>

<div class="footer">All right reserved Â© by Tech AD</div>

<!-- Native Ad -->
<div style="max-width:900px;margin:20px auto;text-align:center;">
<script async data-cfasync="false" src="https://pl28379782.effectivegatecpm.com/300138f18b9ecba409578858202fe959/invoke.js"></script>
<div id="container-300138f18b9ecba409578858202fe959"></div>
</div>

<script>
async function fetchTrack(){
    const url = document.getElementById('url').value;
    const resultDiv = document.getElementById('result');
    const loadingDiv = document.getElementById('loading');
    const errorDiv = document.getElementById('error');
    const fetchBtn = document.getElementById('fetchBtn');

    // Reset
    errorDiv.style.display = 'none';
    resultDiv.innerHTML = '';
    
    // Validate URL
    if(!url || !url.includes('open.spotify.com/track/')){
        showError('Please enter a valid Spotify track URL');
        return;
    }

    // Show loading
    loadingDiv.style.display = 'block';
    fetchBtn.disabled = true;
    fetchBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';

    try {
        // Call our Vercel API endpoint
        const res = await fetch(`/api/spotify?url=${encodeURIComponent(url)}`);
        const data = await res.json();

        if(data.statusCode !== 200){
            throw new Error(data.error || 'Failed to fetch track');
        }

        // Parse track info
        const trackInfo = parseTrackInfo(data.title);
        
        // Display result
        resultDiv.innerHTML = `
            <div class="box">
                <div class="track-info">
                    <div class="track-header">
                        <img src="${data.thumbnail}" alt="${trackInfo.trackName}" class="track-thumb" 
                             onerror="this.src='https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80'">
                        <div class="track-text">
                            <h3>${trackInfo.trackName}</h3>
                            <p>${trackInfo.artist}</p>
                            <div class="track-duration">
                                <i class="far fa-clock"></i> ${data.duration}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="download-options">
                    <h3><i class="fas fa-download"></i> Download Options</h3>
                    ${data.medias.map(media => `
                        <div class="download-item">
                            <div class="quality-info">
                                <span class="quality-badge">${media.quality}</span>
                                <span class="format-badge">${media.extension.toUpperCase()}</span>
                                <span>${media.type}</span>
                            </div>
                            <a href="${media.url}" class="download-btn" download>
                                <i class="fas fa-download"></i> Download
                            </a>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;

    } catch (error) {
        console.error('Error:', error);
        showError(error.message || 'Failed to fetch track. Please try again.');
    } finally {
        // Hide loading
        loadingDiv.style.display = 'none';
        fetchBtn.disabled = false;
        fetchBtn.innerHTML = '<i class="fas fa-download"></i> Get Track';
    }
}

function parseTrackInfo(title){
    // Simple parsing: split by comma
    const parts = title.split(',');
    const trackName = parts[0]?.trim() || title;
    const artist = parts[1]?.trim() || 'Unknown Artist';
    
    return { trackName, artist };
}

function showError(message){
    const errorDiv = document.getElementById('error');
    errorDiv.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
    errorDiv.style.display = 'block';
    
    // Scroll to error
    errorDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

// Allow Enter key to trigger fetch
document.getElementById('url').addEventListener('keypress', function(e){
    if(e.key === 'Enter'){
        fetchTrack();
    }
});
</script>

</body>
</html>